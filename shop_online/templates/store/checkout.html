{% extends 'store/base.html' %}

{% block title %}Checkout - My Store{% endblock %}

{% block content %}
    <div class="checkout-container">
        <h1>Checkout</h1>

        <h3>Your Cart:</h3>
        {% if items %}
            <ul class="cart-items-list">
                {% for item in items %}
                    <li class="cart-item">
                        <span class="product-name">{{ item.product.name }}</span> 
                        <span class="quantity">{{ item.quantity }} x ${{ item.product.price }}</span>
                        <strong>Total: ${{ item.get_total_price }}</strong>
                    </li>
                {% endfor %}
            </ul>
            <h3 class="total-amount">Total: ${{ total }}</h3>

            <form action="{% url 'store:place_order' %}" method="POST" class="checkout-form">
                {% csrf_token %}

                <!-- Detalii personale -->
                <label for="full_name">Full Name</label>
                <input type="text" id="full_name" name="full_name" required>

                <label for="email">Email</label>
                <input type="email" id="email" name="email" required>

                <label for="phone">Telephone</label>
                <input type="tel" id="phone" name="phone" required>

                <label for="address">Delivery Address</label>
                <input type="text" id="address" name="address" required>

                <label for="city">City</label>
                <input type="text" id="city" name="city" required>

                <label for="postal_code">Postal Code</label>
                <input type="text" id="postal_code" name="postal_code" required>

                <!-- Metoda de plată -->
                <label for="payment">Payment Method</label>
                <select id="payment" name="payment">
                    <option value="">-- Select --</option>
                    <option value="credit_card">Credit Card</option>
                    <option value="paypal">PayPal</option>
                    <option value="bank_transfer">Bank Transfer</option>
                    <option value="cash_on_delivery">Cash on Delivery</option>
                </select>

                <!-- Detalii card -->
                <div id="card_details" class="payment-method-details" style="display: none;">
                    <label for="card_number">Card Number</label>
                    <input type="text" id="card_number" name="card_number" required>

                    <label for="expiry_date">Expiration Date</label>
                    <input type="month" id="expiry_date" name="expiry_date" required>

                    <label for="cvv">CVV</label>
                    <input type="text" id="cvv" name="cvv" required>
                </div>

                <!-- Detalii transfer bancar -->
                <div id="bank_details" class="payment-method-details" style="display: none;">
                    <h3>Bank Transfer Details</h3>
                    <p>Transfer the amount to the following account:</p>
                    <p>Account Number: XXXXXX</p>
                    <p>Bank Name: Example Bank</p>
                    <p>IBAN: XXXXXXXXXX</p>
                </div>

                <!-- Detalii plata ramburs -->
                <div id="cash_details" class="payment-method-details" style="display: none;">
                    <h3>Cash on Delivery</h3>
                    <p>You will pay the total amount in cash when the delivery arrives.</p>
                </div>

                <!-- Opțiuni de livrare -->
                <label for="delivery_type">Delivery Type</label>
                <select id="delivery_type" name="delivery_type">
                    <option value="standard">Standard (2-3 days)</option>
                    <option value="express">Express (24h)</option>
                </select>

                <!-- Note pentru livrare -->
                <label for="notes">Notes for Delivery</label>
                <textarea id="notes" name="notes"></textarea>

                <label>
                    <input type="checkbox" required>
                    I agree to the <a href="/terms">terms and conditions</a>.
                </label>

                <button type="submit">Place Order</button>
            </form>
        {% else %}
            <p>Your Cart is Empty!</p>
        {% endif %}
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const paymentSelect = document.getElementById("payment");
            const cardDetails = document.getElementById("card_details");
            const bankDetails = document.getElementById("bank_details");
            const cashDetails = document.getElementById("cash_details");

            // Ascunde secțiunile de plată de la început
            cardDetails.style.display = "none";
            bankDetails.style.display = "none";
            cashDetails.style.display = "none";

            // Evenimentul de schimbare al metodei de plată
            paymentSelect.addEventListener("change", function() {
                cardDetails.style.display = "none";
                bankDetails.style.display = "none";
                cashDetails.style.display = "none";

                if (this.value === "credit_card" || this.value === "paypal") {
                    cardDetails.style.display = "block";
                } else if (this.value === "bank_transfer") {
                    bankDetails.style.display = "block";
                } else if (this.value === "cash_on_delivery") {
                    cashDetails.style.display = "block";
                }
            });
        });
    </script>
{% endblock %}